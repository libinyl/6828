# Lab2 笔记

## 目标: 实现内存管理

## 实验结构:

1. 物理页管理
2. 虚拟内存管理
   1. 虚拟地址,线性地址,物理地址的关系
   2. 引用计数
   3. 页表管理
3. 内核地址空间
   1. 权限和故障隔离
   2. 初始化内核地址空间

## 问答

### Q1: 内存管理包括哪几部分,分别有什么作用?

内存管理分两部分: **物理内存分配器**和**虚拟内存**.

内核通过物理内存分配器来申请/释放实际的物理内存.它以 4096 字节为单位进行操作,我们称这个单位为"页". 物理内存分配器以下简称分配器.

### Q1.1: 物理内存分配器如何实现申请/释放物理内存?

它维护了一个数据结构,记录了哪些物理页的状态(占用/释放),记录了每页有多少个进程在共享.

### Q1.1.1 "申请" 是什么意思?为何需要申请?

### Q1.1.1 物理内存分配器如何实现申请物理内存?

1. 初始化,获取释放状态的 page list
2. 建立虚拟内存

### Q1.1.1.1 初始化的目的是什么,进行了什么操作?

初始化过程得到了一个处于**释放** 状态的物理页的 list.

### Q1.1.1.1 分配器

对于某个申请 n 个字节物理内存的请求,分配器首先获取当前物理可用的地址位置,然后返回增加 n 个自己后的指针,标记这个增加后的地址为当前可用的物理地址.(可以用 static 变量).这其中的取余就是新申请的内存.

### Q1.1.2 物理内存分配器如何实现释放物理内存?

## 代码分析记录

内存管理函数调用链:

mem_init(void)
i386_detect_memory();
boot_alloc(PGSIZE);
page_init();
check_page_free_list(1);
check_page_alloc();
check_page();


## 搁置问题

### 如何验证 kernel.ld 中每个段确实加载到了指定位置?


## 名词解释

UVPT: 