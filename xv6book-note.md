xv6 阅读笔记

# boot loader

## 时序和原理

1. 当 PC 启动时首先执行？
   
   BIOS.
2. BIOS 存储的位置？
   
   写死在母板上。
3. BIOS 的任务？
   
   预处理硬件环境，并把控制权教给 boot loader.
4. boot loader 的位置？
   
   启动盘第一个扇区的前 512 字节。
5. BIOS 把 boot loader 的指令读取到内存中的哪里？
   
   `0x7c00`地址，然后跳到这个地址（更改 ip 寄存器）开始执行。
6. 处理器刚开始的模式？
   
   实模式。Intel 8088. 只能工作在：16 位。
7. boot loader 的任务？
   
   把处理器从**实模式**切换到**保护模式**, 以加载 kernel.
8. 处理器的保护模式是？
   
   是现代的模式，工作在 32 位，用于加载 kernel.

## 代码详解

boot loader 的代码包含两部分：
   
   - `boot/asm.S`: 16 位和 32 位汇编混合代码
   - `boot/main.c`: C 代码

**汇编 bootstrap**

1. boot loader 的第一个指令是？
   
    `cli`.
2. `cli`的作用？
   
    去使能 CPU 中断 (interrupt).~~~~
3. 中断的作用？
   
   用于硬件设备调用操作系统函数（中断处理器，interrupt handlers).
4. 去使能 CPU 中断的原因？
   
   BIOS 就是个袖珍操作系统，为了初始化硬件可能会建立它自己的中断处理器。但 BIOS 已经将控制权转交给了 boot loader, BIOS 已经不再运行，所以继续运行 BIOS 的中断向量表已经不再安全。当 xv6 准备就绪，还会重新使能中断。
5. CPU 在实模式只有 8 个 16 位通用寄存器,但是处理器可以寻址 20 位内存.这是如何做到的?
   
   段寄存器`%cs,%ds,%es,%ss`提供了更强的寻址能力.当程序寻址 20位地址时,addr = 16 * 段寄存器值 + 偏移地址.

6. 分别何时用到`%cs`,`%ds`,`%ss`寄存器?
   
   - 指令获取:`%cs`
   - 数据读写:`%ds`
   - 栈读写:`%ss`
  
7. 什么是线性地址,物理地址,逻辑地址?
   
   暂略.

8. 